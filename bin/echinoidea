#!/usr/bin/env ruby
# encoding: UTF-8

require 'yaml'
require "echinoidea"
require 'optparse'
opt = OptionParser.new

OPTS = {}
opt.on('-o VAL') {|v| OPTS[:o] = v }
opt.parse!(ARGV)

if OPTS[:o] == nil || OPTS[:o] == ""
  STDERR.puts "Specify output directory with option -o. echinoidea -o output_directory"
  exit
end

current_dir = Dir::pwd

if !Echinoidea::project_root_directory?(current_dir)
  STDERR.puts "#{Dir::pwd} is not root directory of a unity project."
  exit
end
if !Echinoidea::config_exists?(current_dir)
  STDERR.puts "No echinoidea.yml exists in #{Dir::pwd}"
  exit
end

if !Echinoidea::editor_directory_exists?(current_dir)
  puts "No Editor directory. Create Editor directory."
  Echinoidea::create_editor_directory(current_dir)
end

# load config
config = YAML.load_file([current_dir, "echinoidea.yml"].join("/"))

builder = Echinoidea::Builder.new(current_dir)
builder.bundle_identifier = config['bundle_identifier'] if config['bundle_identifier']
builder.scenes = config['scenes']
builder.output_directory = OPTS[:o]

builder.run
